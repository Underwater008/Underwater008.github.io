import{S as te,C as Z,W as ie,P as ne,V as N,A as re,D as ae,b as P,c as J,T as j,d as se,e as le,L as ce,R as de,f as ue,M as fe,g as me,B as K,h as Q,i as pe,j as ge}from"./three.module-BItJK9am.js";import{O as ve,G as I}from"./GLTFLoader-CwpOJYn1.js";import he from"https://cdn.skypack.dev/lottie-web";const ye="varying vec3 vPosition;varying vec2 vUv;varying float vMoveDistance;uniform float iAudioData;uniform float iScale;uniform sampler2D iOriginalColor;void main(){vUv=uv;vec3 originalColor=texture(iOriginalColor,uv).rgb;float blackness=1.0-dot(originalColor,vec3(0.333));vec3 modifiedPosition=position;modifiedPosition+=normal*iAudioData*iScale;vMoveDistance=length(modifiedPosition-position);vPosition=modifiedPosition;gl_Position=projectionMatrix*modelViewMatrix*vec4(modifiedPosition,1.0);}",we="uniform float iTime;uniform vec2 iResolution;uniform float iSpeed;uniform float iGridSize;uniform float iFrequency;uniform float iBrightness;uniform float iTextScale;uniform sampler2D iChannel0;uniform sampler2D iChannel1;uniform sampler2D iOriginalColor;varying vec2 vUv;varying float vMoveDistance;float text(vec2 fragCoord){vec2 uv=mod(fragCoord.xy,iGridSize)/iGridSize;vec2 block=fragCoord.xy/iGridSize;uv=uv*(iTextScale+1.0);uv+=floor(texture(iChannel1,block/iResolution+iTime*0.002).xy*iGridSize);uv*=0.0625;uv=clamp(uv,0.0,1.0);return texture(iChannel0,uv).r;}vec3 rain(vec2 fragCoord){fragCoord.x-=mod(fragCoord.x,iGridSize);float offset=sin(fragCoord.x*iFrequency);float speed=cos(fragCoord.x*6.0)*0.3+0.7;float y=fract(fragCoord.y/iResolution.y-iTime*speed*iSpeed+offset);return vec3(0.1,1.0,0.35)/(y*iBrightness);}void main(){vec2 fragCoord=vUv*iResolution;vec3 originalColor=texture(iOriginalColor,vUv).rgb;vec3 textRainEffect=text(fragCoord)*rain(fragCoord);vec3 finalColor=originalColor+textRainEffect;float blackness=1.0-dot(originalColor,vec3(0.333));float threshold=0.5;if(blackness>threshold){}gl_FragColor=vec4(finalColor,1.0);}",xe="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",Ce="varying vec2 vUv;void main(){gl_FragColor=vec4(0.0,0.0,0.0,1.0);}";let a,g,E,b,w,U,B,O,u,V;const y=[],Me=2048*2,L=1.5,Se=148,Ae=-1,De=0,be=0,Fe=.2,Te=20,m=new Audio("../audios/The Chainsmokers - Roses (Audio) ft. ROZES (320).mp3"),T=new AudioContext,Ge=T.createMediaElementSource(m),F=T.createAnalyser();Ge.connect(F);F.connect(T.destination);F.fftSize=256;const ze=F.frequencyBinCount,A=new Uint8Array(ze);m.autoplay=!0;m.loop=!0;m.play();let k,D;Re();Ee();ke(3);Be();$();function Re(){a=new te,a.background=new Z(16777215),w=new ie({antialias:!0}),w.setSize(window.innerWidth,window.innerHeight),document.getElementById("threeDScene").appendChild(w.domElement),g=new ne(75,window.innerWidth/window.innerHeight,.1,1e3),g.position.y=4,g.lookAt(new N(0,0,0)),E=new ve(g,w.domElement),b=.0015,E.update(),U=new re(16777215,6),a.add(U),B=new ae(16777215,1),B.position.set(5,5,5),a.add(B),window.addEventListener("mousedown",qe)}function Be(){k=document.getElementById("lottie-container"),D=he.loadAnimation({container:k,renderer:"svg",loop:!0,autoplay:!1,path:"../images/eroseAudioWave.json"});function t(){requestAnimationFrame(t),m.paused?(D.pause(),b=0):D.isPaused&&D.play()}t()}const Le=`
    varying vec3 vColor;

    void main() {
        vColor = color;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
`,We=`
    varying vec3 vColor;
    uniform vec3 wireColor;

    void main() {
        gl_FragColor = vec4(wireColor, 1.0);
    }
`;function Pe(t,d){const o=t.index.array,e=t.attributes.position.array,r=[];for(let l=0;l<o.length;l+=3)r.push([o[l],o[l+1],o[l+2]]);const f=[];for(let l=0;l<r.length;l+=Math.ceil(1/d))f.push(r[l]);const x=f.flat(),s=new K;return s.setAttribute("position",new Q(e,3)),s.setIndex(x),s.computeVertexNormals(),s}function Ee(){let t;O=new I,O.load("../3DModels/3dRose.glb",function(o){u=o.scene,V=u.children[0].material;const e=V.map;u.traverse(function(r){r.isMesh&&(r.material=new P({vertexShader:ye,fragmentShader:we,uniforms:{iTime:{value:0},iSpeed:{value:.01},iResolution:{value:new J(window.innerWidth,window.innerHeight)},iGridSize:{value:8},iFrequency:{value:30},iBrightness:{value:10},iTextScale:{value:8},iChannel0:{value:new j().load("../images/rainCh1.png")},iChannel1:{value:new j().load("../images/rainCh2.png")},iOriginalColor:{value:e},iAudioData:{value:0},iScale:{value:.2}}}))}),u.scale.set(4,4,4),u.customTag="eRose",a.add(u),console.log("Model loaded successfully"),u.traverse(function(r){if(r.isMesh){const x=Pe(r.geometry,.3),s=new se(x),l=new P({vertexShader:Le,fragmentShader:We,uniforms:{wireColor:{value:new Z(16711680)}},vertexColors:!0,side:le});t=new ce(s,l),t.position.copy(u.position),t.rotation.copy(u.rotation),t.scale.set(2.5,2.5,2.5),t.userData.ignoreRaycast=!0,a.add(t)}})},void 0,function(o){console.error("Error loading model:",o)});function d(){requestAnimationFrame(d),u&&(u.rotation.y+=b,t.position.copy(u.position),t.rotation.copy(u.rotation),u.traverse(function(o){if(o.isMesh&&o.material.uniforms){o.material.uniforms.iTime.value+=.05,F.getByteFrequencyData(A);const e=A.reduce((r,f)=>r+f)/A.length;o.material.uniforms.iAudioData.value=e/256}}))}d()}function ke(t,d){let o=performance.now(),e=performance.now();const r=new I;let f,x,s;r.load("../3DModels/pride-rose/source/PrideRose.glb",function(c){s=c.scene,c.scene.traverse(n=>{n.isMesh&&(f=n.geometry,n.material.map&&(x=n.material.map),s.material=new P({vertexShader:xe,fragmentShader:Ce}))})},void 0,function(c){console.error("An error happened while loading the GLB model:",c)});function l(c,n){if(f&&x){const i=s.clone();if(i.position.set(0,c-1.5,-(n-2.3)),i.rotation.set((Math.random()-.5)*Math.PI/4,Math.random()*Math.PI,(Math.random()-.5)*Math.PI/4),i.velocity=new N(0,0,0),a.add(i),y.push(i),y.length>Me){const C=y.shift();a.remove(C)}}else console.warn("Geometry or texture is not loaded yet.")}function G(){requestAnimationFrame(G);const c=performance.now(),n=(c-e)/1e3;if(e=c,!m.paused){if(F.getByteFrequencyData(A),c-o>=Te){o=c;for(let i=0;i<A.length;i+=Math.floor(A.length/(t*t)))if(A[i]>Se){const v=Math.floor(i/t)*Fe;l(0,v)}}y.forEach(i=>{c>i.fallStartTime?(i.velocity.y-=9.8*n,i.position.y+=i.velocity.y*n):(i.position.x+=L*Ae*n,i.position.y+=L*De*n,i.position.z+=L*be*n)});for(let i=y.length-1;i>=0;i--)(Math.abs(y[i].position.x)>10||Math.abs(y[i].position.y)>10||Math.abs(y[i].position.z)>10)&&(a.remove(y[i]),y.splice(i,1));w.render(a,g)}}G()}function $(){requestAnimationFrame($),E.update(),w.render(a,g)}window.addEventListener("resize",function(){g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix(),w.setSize(window.innerWidth,window.innerHeight)});const W=new J,H=new de,Ie=new ue(.02,16,16),q=new fe({color:65280}),_=new me(Ie,q);q.transparent=!0;q.opacity=0;function qe(t){t.preventDefault(),W.x=t.clientX/window.innerWidth*2-1,W.y=-(t.clientY/window.innerHeight)*2+1,H.setFromCamera(W,g);const o=H.intersectObjects(a.children,!0).filter(e=>!e.object.userData.ignoreRaycast);if(o.length>0){const e=o[0].object;console.log(e),T.state==="suspended"&&T.resume().then(()=>{console.log("AudioContext resumed")}),e.parent.customTag==="eRose"&&(m.paused?(m.play(),b=.001):(b=0,m.pause(),D.goToAndStop(0,!0),console.log("1"))),_.position.copy(o[0].point),a.add(_)}}k.addEventListener("click",function(){m.paused?(m.play(),D.play(),b=.001,T.resume().then(()=>{console.log("AudioContext resumed")})):(m.pause(),D.goToAndStop(0,!0),b=.001)});function je(t,d){const o=d.fftSize,e={length:200,scale:.01,rotation:{x:0,y:0,z:0},smoothing:.001,position:{x:0,y:0,z:0}},r=new K,f=new Float32Array(o*3);r.setAttribute("position",new Q(f,3));const x=new pe({color:16711680}),s=new ge(r,x);s.userData.ignoreRaycast=!0,t.add(s);function l(n,i){const C=new Float32Array(n.length);for(let v=0;v<n.length;v++){let h=0,z=0;for(let M=-Math.floor(i/2);M<=Math.floor(i/2);M++)v+M>=0&&v+M<n.length&&(h+=n[v+M],z++);C[v]=h/z}return C}function G(){function n(){const C=new Uint8Array(o);d.getByteTimeDomainData(C);const v=l(C,e.smoothing);for(let h=0;h<o;h++){const z=h/o*e.length-e.length/2,M=0,oe=v[h]/128*e.scale-e.scale/2;f[h*3]=z,f[h*3+1]=M,f[h*3+2]=oe}r.attributes.position.needsUpdate=!0,s.position.set(e.position.x,e.position.y,e.position.z),s.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z)}function i(){requestAnimationFrame(i),n(),w.render(t,g)}i()}G();function c(n){e.length=n.length!==void 0?n.length:e.length,e.scale=n.scale!==void 0?n.scale:e.scale,e.rotation=n.rotation!==void 0?n.rotation:e.rotation,e.smoothing=n.smoothing!==void 0?n.smoothing:e.smoothing,e.position=n.position!==void 0?n.position:e.position}return c({length:20,scale:1,rotation:{x:0,y:Math.PI/2,z:0},smoothing:5,position:{x:-.5,y:-.7,z:0}}),{setWaveformParams:c}}je(a,F);let p,S=[],R=0;const Ue=.01;let X=performance.now();const Oe=1.5;function Ve(t){new I().load("../3DModels/grassMix.glb",function(o){p=o.scene;const e=.5;p.scale.set(e,e,e),p.position.set(0,-1.5,2.2),p.customTag="grass",p.traverse(function(r){r.isMesh&&(r.castShadow=!0,r.receiveShadow=!0)}),t(p)})}function ee(){const t=performance.now(),d=(t-X)/1e3;if(X=t,requestAnimationFrame(ee),!m.paused){if(S.forEach(o=>{o.position.x-=Oe*d}),S=S.filter(o=>o.position.x<-10?(a.remove(o),!1):!0),S.length>0){const o=S[S.length-1];R-o.position.x>Ue&&(Y(6,1),R=o.position.x)}else Y(6,1),R=-4;w.render(a,g)}}function Y(t,d){if(p)for(let o=0;o<t;o++){const e=p.clone();e.position.set(p.position.x,p.position.y,p.position.z-o*d);const r=[Math.PI/2,Math.PI,3*Math.PI/2];e.rotation.y=r[Math.floor(Math.random()*r.length)],a.add(e),S.push(e)}}function He(){Ve(()=>{R=p.position.x,ee()})}He();
